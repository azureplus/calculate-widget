/*    Opens a file named "Icon.psd" (a 1024x1024 document in the same folder as this script) and creates an iconset.    This script is meant to be run from the Icon.scpt AppleScript.        Tested in Photoshop CS6 on Mac OS X   */cTID = function(s) { return app.charIDToTypeID(s); };sTID = function(s) { return app.stringIDToTypeID(s); };resizeAndScaleStyles = function(doc, newWidth) {    var oldDoc = app.activeDocument;    app.activeDocument = doc;        var idImgS = cTID( "ImgS" );    var desc2 = new ActionDescriptor();    var idWdth = cTID( "Wdth" );    var idPxl = cTID( "#Pxl" );    desc2.putUnitDouble( idWdth, idPxl, newWidth);    var idscaleStyles = sTID( "scaleStyles" );    desc2.putBoolean( idscaleStyles, true );    var idCnsP = cTID( "CnsP" );    desc2.putBoolean( idCnsP, true );    var idIntr = cTID( "Intr" );    var idIntp = cTID( "Intp" );    var idBcbc = cTID( "Bcbc" );    desc2.putEnumerated( idIntr, idIntp, idBcbc );    executeAction( idImgS, desc2, DialogModes.NO );       app.activeDocument = oldDoc;}exportAsPNG = function(doc, outFile) {    var options = new ExportOptionsSaveForWeb();    options.format = SaveDocumentType.PNG;    options.PNG8 = false;    options.transparency = true;        doc.info = null;    doc.exportDocument(outFile, ExportType.SAVEFORWEB, options);};var highlightOpacity = 60;var settingsHighlightOpacity = 60;var icons = [    {"name": "icon_16x16", "size": 16 },    {"name": "icon_16x16@2x", "size": 32 },    {"name": "icon_32x32", "size": 32 },    {"name": "icon_32x32@2x", "size": 64},    {"name": "icon_128x128", "size": 128 },    {"name": "icon_128x128@2x", "size": 256 },    {"name": "icon_256x256", "size": 256 },    {"name": "icon_256x256@2x", "size": 512},    {"name": "icon_512x512", "size": 512 },    {"name": "icon_512x512@2x", "size": 1024 },    ];// Save the current preferencesvar startRulerUnits = app.preferences.rulerUnits;var startTypeUnits = app.preferences.typeUnits;var startDisplayDialogs = app.displayDialogs;// Set Adobe Photoshop to use pixels and display no dialogsapp.preferences.rulerUnits = Units.PIXELS;app.preferences.typeUnits = TypeUnits.PIXELS;app.displayDialogs = DialogModes.NO;// Setup inFile, outFoldervar scriptFolder = File($.fileName).parent;var inFile = File(scriptFolder.toString() + "/Icon.psd");var outFolder = scriptFolder.toString() + "/Icon.iconset";new Folder(outFolder).create();// Open the psd filevar doc = app.open(new File(inFile));for (var i in icons) {    var filename = icons[i].name;    var size = icons[i].size;        // Make a resized copy    var tempDoc = doc.duplicate("temp", false);    resizeAndScaleStyles(tempDoc, size);    //tempDoc.flatten();        // Export    exportAsPNG(tempDoc, File(outFolder + "/" + filename + ".png"));        // Cleanup    tempDoc.close(SaveOptions.DONOTSAVECHANGES);        app.activeDocument = doc;}// Close original documentdoc.close(SaveOptions.DONOTSAVECHANGES);doc = null;// Reset the application preferencesapp.preferences.rulerUnits = startRulerUnits;app.preferences.typeUnits = startTypeUnits;app.displayDialogs = startDisplayDialogs;